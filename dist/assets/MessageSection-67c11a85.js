import{j as e,ax as h,r as n,b6 as Y,P as Z}from"./index-f542c721.js";import{k as C,l as R}from"./candidateJobs-9f40d583.js";const ee=({first_name:o,last_name:_,last_message:j,timestamp:w,messageFrom:b,active:M,messageCount:y,chatName:m,handleSelectChatRoom:p,isSelected:g})=>e.jsxs("div",{class:` ${M?"active":""} chat-lists-col ${g?"":"bg-light"}`,onClick:()=>{p(m,o,_)},children:[e.jsx("div",{class:"chat-lists-icon",children:e.jsx("img",{src:"../assets/images/user-profile.svg"})}),e.jsxs("div",{class:"chat-lists-content",children:[e.jsxs("h6",{children:[o," ",_," "]}),e.jsx("p",{children:j})]}),e.jsx("div",{class:"chat-time",children:h(w).format("hh:mm a")})]}),se=()=>e.jsx("span",{className:"spinner-border spinner-border-sm text-dark",role:"status","aria-hidden":"true"}),re=({seekerPage:o=!1})=>{const[_,j]=n.useState(!1),[w,b]=n.useState(!1),[M,y]=n.useState(!1),[m,p]=n.useState([]),[g,I]=n.useState("");n.useState(null);const[d,v]=n.useState([]),[T,L]=n.useState([]),[N,A]=n.useState(),[ae,H]=n.useState(null),[J,te]=n.useState(100),[u,B]=n.useState({firstName:"",lastName:""}),[U,le]=n.useState(1),[K,E]=n.useState(!1),S=n.useRef(),f=n.useRef(),F=localStorage.getItem("user_id"),$=localStorage.getItem("roomId"),[ne,q]=n.useState(),[z,G]=n.useState("");n.useEffect(()=>{b(!0),C().then(s=>{var a,t,i,r;if(s.data.data.length>0){v(s.data.data),L(s.data.data);let l;$?(l=(a=s==null?void 0:s.data)==null?void 0:a.data.find(k=>k.name===$),localStorage.removeItem("roomId")):l=(t=s==null?void 0:s.data)==null?void 0:t.data[0];const c=(i=l==null?void 0:l.reciever_data)==null?void 0:i.first_name,x=(r=l==null?void 0:l.reciever_data)==null?void 0:r.last_name;P(l==null?void 0:l.name,c,x)}b(!1)}).catch(s=>{console.log(s),b(!1)})},[]),n.useEffect(()=>{const s=localStorage.getItem("token");return S.current=new WebSocket(`${Y}/${N}/?token=${s}`),S.current.onopen=()=>{console.log("WebSocket connection established.")},S.current.onmessage=a=>{const t=JSON.parse(a.data);p([...m,t]);const i=[...m,t];q(h(i[0].timestamp).format("hh:mm a"));const r=d==null?void 0:d.findIndex(c=>c.name===N),l=new Date;if(r>=0){const c=[...d];c[r].last_message[0].last_message.message=t==null?void 0:t.message,c[r].last_message[0].last_message.timestamp=l,v(c),L(c)}},()=>{S.current.close()}},[m]),n.useEffect(()=>{f&&f.current&&Q(),console.log(f,"scroll top")},[m]);const P=(s,a,t)=>{s!==N&&j(!0),R(s,U,J).then(i=>{var l,c,x,k,W;H((c=(l=i==null?void 0:i.data)==null?void 0:l.data)==null?void 0:c.count),y(!0);const r=[...(W=(k=(x=i==null?void 0:i.data)==null?void 0:x.data)==null?void 0:k.results)==null?void 0:W.chat_messages].reverse().map(X=>X);p(r),B({firstName:a,lastName:t}),A(s),j(!1)}).catch(i=>{j(!1),console.log(i)})},Q=()=>{f.current.scrollTop=f.current.scrollHeight},D=()=>{if(E(!0),g!==""){p([...m,{message:g,sender:F}]),S.current.send(JSON.stringify({message:g})),I("");const s=d==null?void 0:d.findIndex(a=>a.name===N);if(s>=0){const a=[...d];a[s].last_message[0].last_message.message=g,a[s].last_message[0].last_message.timestamp=new Date,v(a),L(a)}}E(!1)},O=s=>{let a;if(s>0){const t=m[s-1].timestamp,i=m[s].timestamp;a=h.utc(h(i,"hh:mm a").diff(h(t,"hh:mm a"))).format("mm")}if(a>10||s===0)return!0},V=s=>{if(G(s),s.length===0)v(T);else{const a=T.filter(t=>{var i,r,l,c;return(c=(i=t==null?void 0:t.reciever_data)==null?void 0:i.first_name)==null?void 0:c.toLowerCase().includes(s.toLowerCase()||((l=(r=t==null?void 0:t.reciever_data)==null?void 0:r.last_name)==null?void 0:l.toLowerCase().includes(s.toLowerCase())))});v(a)}};return e.jsxs(e.Fragment,{children:[w&&e.jsx(Z,{}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:`${o?"col-xxl-3 col-lg-4 mb-2":"col-xxl-4 col-lg-5 mb-2"} col-12`,children:e.jsxs("div",{className:"chat-list-sec border",children:[e.jsx("h5",{children:"Messages"}),e.jsxs("div",{className:"chat-lists",children:[!o&&e.jsxs("div",{className:"fieldset custom-search",children:[e.jsx("input",{type:"text",name:"",placeholder:"Search by name",className:"form-control input-icon search-field",value:z,onChange:s=>V(s.target.value)}),e.jsx("span",{className:"input-field-icon",children:e.jsx("img",{src:"../assets/images/search-icon.svg"})})]}),d.length>0?d==null?void 0:d.map(s=>{var a,t,i,r,l,c,x;return e.jsx(ee,{isSelected:s.name===N,first_name:(a=s==null?void 0:s.reciever_data)==null?void 0:a.first_name,last_name:(t=s==null?void 0:s.reciever_data)==null?void 0:t.last_name,last_message:(r=(i=s==null?void 0:s.last_message[s.last_message.length-1])==null?void 0:i.last_message)==null?void 0:r.message,timestamp:(c=(l=s==null?void 0:s.last_message[s.last_message.length-1])==null?void 0:l.last_message)==null?void 0:c.timestamp,messageCount:(x=s==null?void 0:s.last_message)==null?void 0:x.length,handleSelectChatRoom:P,chatName:s==null?void 0:s.name,setSenderName:B,active:M},s.id)}):"No chat started yet"]})]})}),e.jsx("div",{className:`${o?"col-xxl-9 col-lg-8 mb-2":"col-xxl-8 col-lg-7 mb-2"} col-12`,children:d.length>0?e.jsxs("div",{className:"chatBox border",children:[e.jsxs("div",{className:"applicant-info-col px-3 border-bottom",children:[e.jsx("div",{className:"applicant-thumb",children:e.jsx("img",{src:"../assets/images/user-profile.svg"})}),e.jsx("div",{className:"applicant-info",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("h6",{children:[u.firstName," ",u.lastName,e.jsxs("span",{children:["4.5 ",e.jsx("i",{className:"fas fa-star"})]})]}),e.jsxs("ul",{children:[e.jsx("li",{children:"Web Developer"}),e.jsx("li",{children:"2 year of exp"}),e.jsx("li",{children:"Full-time"}),e.jsx("li",{children:"Remote"})]})," "]}):e.jsx(e.Fragment,{children:e.jsxs("h6",{children:[u.firstName," ",u.lastName]})})})]}),M&&e.jsxs("div",{className:"chat-container",children:[e.jsx("div",{className:"chat-messages ",ref:f,children:e.jsxs("div",{className:"chat-inner-message",children:[_&&e.jsxs("div",{className:"loaderCenter",children:[" ",e.jsx(se,{})]}),m==null?void 0:m.map((s,a)=>e.jsx(n.Fragment,{children:s.sender==F?e.jsx("div",{className:"messageBox text-end",children:e.jsxs("div",{className:"chatBot d-flex justify-content-end",children:[e.jsxs("div",{className:"ChatbotMesgg",children:[e.jsx("div",{className:"message right bg-black text-white text-start d-inline-block",children:s.message},a),O(a)&&e.jsx("span",{className:"d-block",children:h(s.timestamp).format("hh:mm a")})]}),e.jsx("div",{className:"chat-lists-icon",children:e.jsx("img",{src:"../assets/images/user-profile.svg"})})]})}):e.jsx("div",{className:"messageBox text-start",children:e.jsxs("div",{className:"chatBot d-flex",children:[e.jsx("div",{className:"chat-lists-icon",children:e.jsx("b",{children:u.firstName[0]})}),e.jsxs("div",{className:"ChatbotMesgg",children:[e.jsx("div",{className:"message left text-start d-inline-block",children:s.message},a),e.jsx("span",{className:"d-block",children:O(a)&&h(s.timestamp).format("hh:mm a")})]})]})})},a))]})}),K&&e.jsx("div",{className:"sendingMessageLoader text-end p-3",children:"...Sending"}),e.jsxs("div",{className:"chat-input",children:[e.jsx("div",{className:"input w-100 pe-4",children:e.jsx("input",{type:"text",className:"w-100",placeholder:"Type your message...",value:g,onChange:s=>I(s.target.value),onKeyDown:s=>{s.key==="Enter"&&D()}})}),e.jsx("div",{className:"sendButton",onClick:D,children:e.jsx("img",{src:"/assets/images/send.svg"})})]})]})]}):e.jsx("div",{children:"No chat started yet"})})]})]})};export{re as M};
